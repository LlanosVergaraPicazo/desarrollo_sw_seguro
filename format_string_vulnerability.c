/* 
 * Programa demostrativo de vulnerabilidad de errores de formateado de Entrada/Salida
 * Asignatura: Desarrollo de Software Seguro (31105147 - UNED)
 * Basado en principios de "Secure Coding in C and C++".
 */

#include <stdio.h>
#include <string.h>
#include <stdlib.h>

// Funcion vulnerable: pasa la entrada directamente como formato
void vulnerable_output(const char *input) {
    printf("[Vulnerable] Mostrando entrada sin formato fijo...\n");
    printf(input); // Vulnerabilidad de format string
    printf("\n");
}

// Funcion segura: utiliza un formato fijo al mostrar la entrada
void safe_output(const char *input) {
    printf("[Seguro] Mostrando entrada con formato seguro...\n");
    printf("%s\n", input);
}

int main() {
    char user_input[200];

    printf("Introduce un mensaje: ");
    if (fgets(user_input, sizeof(user_input), stdin) != NULL) {
        size_t len = strlen(user_input);
        if (len > 0 && user_input[len-1] == '\n') {
            user_input[len-1] = '\0';
        }

        printf("\n-- Salida vulnerable --\n");
        vulnerable_output(user_input);

        printf("\n---\n\n");

        printf("-- Salida segura --\n");
        safe_output(user_input);
    } else {
        printf("Error al leer la entrada.\n");
    }

    return 0;
}
